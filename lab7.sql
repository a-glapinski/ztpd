-- Zad. 1.
-- A.
create table A6_LRS
(
    GEOM SDO_GEOMETRY
);

-- B.
insert into A6_LRS
select GEOM
from STREETS_AND_RAILROADS
where SDO_WITHIN_DISTANCE(
              GEOM,
              (select GEOM from MAJOR_CITIES where CITY_NAME = 'Koszalin' and rownum = 1),
              'distance=10 unit=km') = 'TRUE';

-- C.
select SDO_GEOM.SDO_LENGTH(A.GEOM, 1, 'unit=km') DISTANCE,
       ST_LINESTRING(A.GEOM).ST_NUMPOINTS()      ST_NUMPOINTS
from A6_LRS A;

-- D.
update A6_LRS
set GEOM = SDO_LRS.CONVERT_TO_LRS_GEOM(GEOM, 0, 276.681);

-- E.
insert into USER_SDO_GEOM_METADATA
values ('A6_LRS', 'GEOM',
        MDSYS.SDO_DIM_ARRAY(
                MDSYS.SDO_DIM_ELEMENT('X', 12.603676, 26.369824, 1),
                MDSYS.SDO_DIM_ELEMENT('Y', 45.8464, 58.0213, 1),
                MDSYS.SDO_DIM_ELEMENT('M', 0, 300, 1)),
        8307);

-- F.
CREATE INDEX A6_LRS_IDX ON A6_LRS (geom) INDEXTYPE IS MDSYS.SPATIAL_INDEX;

-- Zad. 2.
-- A.
select SDO_LRS.VALID_MEASURE(GEOM, 500) VALID_500
from A6_LRS;

-- B.
select SDO_LRS.GEOM_SEGMENT_END_PT(GEOM) END_PT
from A6_LRS;
-- MDSYS.SDO_GEOMETRY(3301, 8307, NULL, MDSYS.SDO_ELEM_INFO_ARRAY(1, 1, 1), MDSYS.SDO_ORDINATE_ARRAY(14.87555, 53.60957, 276.681))

-- C.
select SDO_LRS.LOCATE_PT(GEOM, 150, 0) KM150
from A6_LRS;
-- MDSYS.SDO_GEOMETRY(3301, 8307, NULL, MDSYS.SDO_ELEM_INFO_ARRAY(1, 1, 1), MDSYS.SDO_ORDINATE_ARRAY(16.4179636222052, 54.2502354261516, 150))

-- D.
select SDO_LRS.CLIP_GEOM_SEGMENT(GEOM, 120, 160) CLIPPED
from A6_LRS;
--MDSYS.SDO_GEOMETRY(3302, 8307, NULL, MDSYS.SDO_ELEM_INFO_ARRAY(1, 2, 1), MDSYS.SDO_ORDINATE_ARRAY(16.8000392442849, 54.40103096357, 120, 16.62392, 54.329121, 133.968762281008, 16.422119, 54.25161, 149.688923477096, 16.2845305950441, 54.205971749082, 160))

-- E.
select SDO_LRS.GET_NEXT_SHAPE_PT(
               A.GEOM,
               SDO_LRS.PROJECT_PT(A.GEOM, C.GEOM)) as WJAZD_NA_A6
from A6_LRS A,
     MAJOR_CITIES C
where C.CITY_NAME = 'Slupsk';

-- F.
select SDO_GEOM.SDO_LENGTH(
               SDO_LRS.OFFSET_GEOM_SEGMENT(
                       A6.GEOM, M.DIMINFO, 50, 200, 50, 'unit=m'), 1, 'unit=m') as KOSZT
from A6_LRS A6,
     USER_SDO_GEOM_METADATA M
where M.table_NAME = 'A6_LRS'
  and M.COLUMN_NAME = 'GEOM';
